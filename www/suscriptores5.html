<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="width=device-width, initial-scale=1, maximun-scale=no">

        <meta http-equiv="Expires" content="0" />
        <meta http-equiv="Pragma" content="no-cache" />

        <link rel="stylesheet" href="css/styleSuscriptores.css" />
        <link rel="stylesheet" type="text/css" href="css/styleMenu.css">
        <link rel="stylesheet" type="text/css" href="fonts/fonts.css">               

        <title>Inscripciones</title>

    </head>
    <body>

        <!-- Inicia Página -->
        <div id="inscripciones">

        <!-- Encabezado de la página -->
        <div>
            <h1>Confirmación de Inscripción</h1>
            <div class="menu_bar">
                <a href="#" class="bt-menu" id="showMenu"><span class="icon-menu"></span> Menu</a>
            </div>
        </div>

        <!-- Contenido de la página-->
        <div id="contenedor" style="overflow-x: auto;">

            <div id="bienvenida">
                <p>Por favor revise su información, si hay algo que desee cambiar presione el botón ANTERIOR para ir a la ventana correspondiente.</p>  
                <p style="font-weight:normal">Puede navegar hacia adelante y atrás usando los botones de ANTERIOR y SIGUIENTE.</p>
            </div>
            
            <div id="clear" >
                
                <form action="#" id="inscripcion" name="inscripcion">
                    <table>
                         <tbody>
                           <tr>
                             <th>Nombre:</th>
                             <td style="border:1px solid #087CCD;">
                                 <label for="Nombre" id="lblNombre"></label>
                             </td>
                           </tr>
                           <tr>
                             <th>Teléfono de Contacto:</th>
                             <td style="border:1px solid #087CCD;">
                                <label for="Telefono" id="lblTelefono"></label>
                            </td>                                                   
                           </tr>
                            <tr>
                                <th>Correo Electrónico:</th>
                                <td style="border:1px solid #087CCD;">
                                    <label for="Email" id="lblEmail"></label>
                                </td>    
                            </tr>
                            <tr>
                                <th>Dirección Fiscal:</th>
                                <td id="tdEstado" style="border:1px solid #087CCD;">
                                    <label for="Calle" id="lblCalle"></label><br>
                                    <label for="Colonia" id="lblColonia"></label><br>
                                    <label for="Ciudad" id="lblCiudad"></label><br>
                                    <select  name="estado" id="estado" disabled>
                                    </select><br>
                                    <label for="CP" id="lblCP"></label><br>
                                </td>    
                            </tr>
                            <tr>
                                <th>Número y Nombre de Patrocinador:</th>
                                <td style="border:1px solid #087CCD;">
                                    <label for="Patrocinador" id="lblPatrocinador"></label>
                                </td>    
                            </tr>
                            <tr>
                                <th>Colocado Debajo de:</th>
                                <td style="border:1px solid #087CCD;">
                                    <label for="Colocacion" id="lblColocacion"></label>
                                </td>    
                            </tr> 
                            <tr style="background-color:#ffffff">
                                <td colspan="2" style="height:10px;"></td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <a href="#" onclick="Href('suscriptores4.html')" ><span class="icon-arrow-left"></span> ANTERIOR</a>
                                    <!--<a href="suscriptores3.html"   data-role="button">SIGUIENTE -></a>-->
                                    <button type="button" id="btnSiguiente5" name="btnSiguiente4"  onclick="">TERMINAR <span class='icon-point-right'></span></button>
                                </td>
                            </tr>
                         </tbody>
                   </table>
                </form>

                <table id="order">
                    <thead>
                        <tr>
                            <th colspan="3">ORDEN DE INSCRIPCIÓN</th>
                        </tr>
                        <tr>
                            <th>Código Artículo</th>
                            <th>Descripción</th>
                            <th>Precio</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th colspan="2">Subtotal</th>
                            <td></td>
                        </tr>
                        <tr>
                            <th colspan="2">Cargo por envío</th>
                            <td></td>
                        </tr>
                        <tr>
                            <th colspan="2">Impuesto Total</th>
                            <td></td>
                        </tr>
                        <tr>
                            <th colspan="2">Total</th>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
        
            </div>

        </div>

        <div id="deviceready" style="display: none">
            <p class="event listening">Connecting to Device</p>
            <p class="event received">Device is Ready</p>
        </div>

    </div>
    
   <!-- ********  MENÚ  ******** -->
    <header>
        <nav id="menu"></nav>
    </header>

    <!--Mascara que se muestra cuando se abre menú-->
    <section id="mascara"></section>

    <!--Macara que se muestra  mientras se cargan todos los elementos de la página-->
    <div id="mascaraAJAX"></div>
    

    <script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
    <script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/classMenu.js"></script>
    <script type="text/javascript" src="js/suscriptores.js"></script>
    <script type="text/javascript" src="js/menu.js"></script>
    <script type="text/javascript" src="js/validaciones.js"></script>
    
    <script type="text/javascript" src="js/lib.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/logout.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/notificaciones.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/connect.js"></script>
    <script type="text/javascript"> 
            //El registro al servicio de google lo hacemos automáticamente
            app.initialize();            
            menu.cargarMenu();

            //Se declara IVA como constante
            const IVA = 0.16;

            //Carga imagen ajax
            showWaitLoader('mascaraAJAX');
            $('#mascaraAJAX').fadeIn(300);

            //Borra Historial del Botón back
            if(history.forward(1))
                location.replace(history.forward(1));

            /*Devuelve conjunto de datos y carga SELECT de ESTADOS con los datos obtenidos*/
            queryData('USP_VBC_GET_STATES', ['integer', '4'], fillStates);

            function fillStates(dataSet){
                var rec = dataSet[0];
                var text = '';

                for(var idx = 0; idx < dataSet.length; idx++){
                    rec = dataSet[idx];
                    text += '<option value="'+ rec["stateCode"] +'">'+ rec["state"] +'</option>';
                };

                $('#estado').append(text);

                var extraer = localStorage.getItem('susc3Local');
                var ResArray = extraer.split('","');

                $('#estado').val(ResArray[6]);
            }




            //Se obtiene código de producto que solicito usuario para extraer sus detalles
            if(localStorage.getItem('susc2Local')){
                var extraer = localStorage.getItem('susc2Local');
                var ResArray = extraer.split('","');

                var kit_code = ResArray[12];
                var shipping_method;
                //Bandera para saber si es valido el código del serializable
                var serial_code_flag;

                console.log(ResArray);

                if(ResArray.length == 18){
                    shipping_method = ResArray[15];
                    serial_code_flag = ResArray[13];
                }else{
                    shipping_method = ResArray[13];
                    serial_code_flag = 'scNo';
                }
            }

            //========================================================================================================//
            //Se verifica si el paquete de inscripción fue serializaco o no, para realizar sus respectivas operaciones//
            //========================================================================================================//
            if(serial_code_flag == 'scNo'){//Se llena la tabla de forma normal
                /*Devuelve conjunto de datos y llena datos de la orden*/
                queryData('USP_VBC_GET_ITEMS_KITS', ['integer', '4'], fillTableOrder);console.log('aqui');

                function fillTableOrder(dataSet){
                    var rec = dataSet[0];
                    var text = '';

                    for(var idx = 0; idx < dataSet.length; idx++){
                        rec = dataSet[idx];

                        if(rec['itemCode'] == kit_code){
                            text += '<tr>';
                            text += '<td>'+ rec['itemCode'] +'</td>';
                            text += '<td>'+ rec['description'] +'</td>';
                            text += '<td>$ '+ Math.round(rec['retail']*100)/100 +'</td>';
                            text += '</tr>';

                            var kit_price = Math.round(rec['retail']*100)/100;
                            var kit_weight = rec['weight'];
                        }
                        
                    };

                    //Se cargan datos obtenidos en la tabla de la Orden
                    $('table#order tbody').prepend(text);
                    $('table#order tbody tr:nth-child(2) td').append('$ '+kit_price);

                    //Se calcula costo de envío
                    var xml = '<PAGE><CART GRAN_TOTAL_ITEM_WEIGHT="'+ kit_weight +'" COUNTRY_ID="4"/><SHIPPING_ADDRES SHIPPING_METHOD="'+ shipping_method +'" CARRIER="3"/></PAGE>';
                    queryData('USP_VBC_GET_SHIPPING_COST', ['string',depurarXML(xml)], calculaEnvio);
                    var costoXenvio = 0;
                    function calculaEnvio(dataSet) {
                        
                        var rec = dataSet[0];
                        //Si el metodo de envío es Ocurre no se cobra costo por envío
                        if(rec['shippingCharge'] == null){
                            $('table#order tbody tr:nth-child(3) td').append('$ '+(0).toFixed(2));
                        }else{
                            $('table#order tbody tr:nth-child(3) td').append('$ '+(rec['shippingCharge']).toFixed(2));
                        }                    
                        costoXenvio = rec['shippingCharge'];

                        //Una vez que se obtiene el costo por envío hacemos los calculos totales
                        var impuesto_total = kit_price * IVA;
                        var gran_total = impuesto_total + costoXenvio + kit_price;
                        //var gran_total = total.toFixed(2);

                        $('table#order tbody tr:nth-child(4) td').append('$ '+Math.round(impuesto_total*100)/100);
                        $('table#order tbody tr:nth-child(5) td').append('$ '+Math.round(gran_total*Math.pow(10,2))/Math.pow(10,2));
                    }

                    //oculta imagen ajax
                    $('#mascaraAJAX').fadeOut(300);
                    $('#mascaraAJAX').html(''); 

                }
            }else if(serial_code_flag == 'sc0'){console.log('aqui succes');
                /*Devuelve conjunto de datos y llena datos de la orden*/
                queryData('USP_VBC_GET_ITEMS_KITS', ['integer', '4'], fillTableOrder2);

                function fillTableOrder2(dataSet){
                    var rec = dataSet[0];
                    var text = '';

                    for(var idx = 0; idx < dataSet.length; idx++){
                        rec = dataSet[idx];

                        if(rec['itemCode'] == kit_code){
                            text += '<tr>';
                            text += '<td>'+ rec['itemCode'] +'</td>';
                            text += '<td>'+ rec['description'] +'</td>';
                            text += '<td>$ '+ (0).toFixed(2) +'</td>';
                            text += '</tr>';

                            var kit_price = (0).toFixed(2);
                            var kit_weight = 0;
                        }
                        
                    };

                    //Se cargan datos obtenidos en la tabla de la Orden
                    $('table#order tbody').prepend(text);
                    $('table#order tbody tr:nth-child(2) td').append('$ '+kit_price);

                    //Se calcula costo de envío
                    var xml = '<PAGE><CART GRAN_TOTAL_ITEM_WEIGHT="'+ kit_weight +'" COUNTRY_ID="4"/><SHIPPING_ADDRES SHIPPING_METHOD="'+ 1 +'" CARRIER="3"/></PAGE>';
                    queryData('USP_VBC_GET_SHIPPING_COST', ['string',depurarXML(xml)], calculaEnvio2);
                    var costoXenvio = 0;
                    function calculaEnvio2(dataSet) {
                        
                        var rec = dataSet[0];
                        //Si el metodo de envío es Ocurre no se cobra costo por envío
                        if(rec['shippingCharge'] == null){
                            $('table#order tbody tr:nth-child(3) td').append('$ '+(0).toFixed(2));
                        }else{
                            $('table#order tbody tr:nth-child(3) td').append('$ '+(rec['shippingCharge']).toFixed(2));
                        }                    
                        costoXenvio = 0.00;

                        //Una vez que se obtiene el costo por envío hacemos los calculos totales
                        var impuesto_total = kit_price * IVA;
                        var gran_total = impuesto_total + costoXenvio + kit_price;console.log(impuesto_total+" "+costoXenvio+ " "+ kit_price+ " "+ gran_total);
                        //var gran_total = total.toFixed(2);

                        $('table#order tbody tr:nth-child(4) td').append('$ '+(impuesto_total).toFixed(2));
                        $('table#order tbody tr:nth-child(5) td').append('$ '+ (0).toFixed(2));
                    }

                    //oculta imagen ajax
                    $('#mascaraAJAX').fadeOut(300);
                    $('#mascaraAJAX').html(''); 

                }
            }
        
    </script>
    </body>
</html>